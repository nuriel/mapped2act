var initLocationAutocomplete = function() {
    var inputID = 'location_autocomplete'
    $('#' + inputID).select2({
        quietMillis: 400,
        minimumInputLength: 3,
        placeholder: 'Enter location',
        multiple: true,
        maximumSelectionSize: 1,
        ajax: {
            url: $('#' + inputID).data('url'),
            dataType: "json",
            data: function (term, page) {return {q:term, page: page, per: 10}},
            results: function (data, page) {
                return {results: data};
            }
        },
        initSelection : function (element, callback) {
            var elementText = $(element).attr('data-init-text');
            autocomplete_input = $('#location_autocomplete')
            callback({text: autocomplete_input.data('value'), id: [] });
        }

    });

}

var geolocate = function(inputId) {
    // handle loader
    loader.find('span').text('Geolocating...');
    loader.addClass('loading').fadeIn();

    // geolocate (autocomplete with no query param)
    $.getJSON('/api/locations/autocomplete.json', function(data) {
        $('#'+inputId).select2('data', data)
        wizUpdateSpecificLocation(inputId);
    });
}

var updateSelectedLocation = function(inputId) {
    data = $('#'+inputId).select2('data')[0];
    $('#'+inputId).val(data.text);
    $('#cause_latitude').val(data.id['lat']);
    $('#cause_longitude').val(data.id['lng']);
}


$(document).ready(function() {
    initLocationAutocomplete();

    // location autocomplete
    $('#location_autocomplete').on("change", function() { updateSelectedLocation("location_autocomplete") });
    // location geolocate
    $("body").on("click", "#geolocate_icon", function() { wizGeolocate("location_autocomplete_input") });
});